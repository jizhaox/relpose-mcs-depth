clear
format long

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 2AC vertical solver & inter-camera case %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
disp('--------------2AC solver with known vertical direction & inter-camera case--------------')
%% generate synthetic data
match_type = 'inter';
[Image1, Image2, At, R_cam, t_cam, R_gt, t_gt, theta_y_gt] = generate_2AC_4dof_data('4DOF', match_type);
%% run solver
[R_sol, t_sol, theta_y_sol] = solver_depth_2ac_4dof(Image1, Image2, At, R_cam, t_cam, match_type);
% display
[~, idx] = min(abs(theta_y_sol - theta_y_gt));
R_sol(:, :, idx), R_gt
t_sol(:, idx), t_gt

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 2AC vertical solver & intra-camera case %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
disp('--------------2AC solver with known vertical direction & intra-camera case--------------')
%% generate synthetic data
match_type = 'intra';
[Image1, Image2, At, R_cam, t_cam, R_gt, t_gt, theta_y_gt] = generate_2AC_4dof_data('4DOF', match_type);
%% run solver
[R_sol, t_sol, theta_y_sol] = solver_depth_2ac_4dof(Image1, Image2, At, R_cam, t_cam, match_type);
% display
[~, idx] = min(abs(theta_y_sol - theta_y_gt));
R_sol(:, :, idx), R_gt
t_sol(:, idx), t_gt

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 2AC vertical solver & inter-camera case %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
disp('--------------2AC solver with known vertical direction & inter-camera case--------------')
%% generate synthetic data
match_type = 'inter';
[Image1, Image2, At, R_cam, t_cam, R_gt, ~, t_gt] = generate_2AC_data(match_type);
[R_imu, theta_y_gt] = generate_imu_measurement(R_gt);

%% run solver
% method 1: convert observations using IMU measurements
R_left = R_imu(:, :, 1);
R_right = R_imu(:, :, 2);


% method 2: use the second solver. general but slow
[R_sol, t_sol, theta_y_sol] = solver_depth_2ac_4dof_v2(Image1, Image2, At, R_cam, t_cam, R_imu, match_type);

% display
[~, idx] = min(abs(theta_y_sol - theta_y_gt));
R_sol(:, :, idx), R_gt
t_sol(:, idx), t_gt

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 2AC vertical solver & inter-camera case %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
disp('--------------2AC solver with known vertical direction & intra-camera case--------------')
%% generate synthetic data
match_type = 'intra';
[Image1, Image2, At, R_cam, t_cam, R_gt, ~, t_gt] = generate_2AC_data(match_type);
[R_imu, theta_y_gt] = generate_imu_measurement(R_gt);

%% run solver
[R_sol, t_sol, theta_y_sol] = solver_depth_2ac_4dof_v2(Image1, Image2, At, R_cam, t_cam, R_imu, match_type);

% display
[~, idx] = min(abs(theta_y_sol - theta_y_gt));
R_sol(:, :, idx), R_gt
t_sol(:, idx), t_gt
